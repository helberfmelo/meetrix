## Objetivo do PR
Implementar o item P1-3 do roadmap YCBM: notificacoes parametrizadas por evento com templates por idioma.

## Etapa / Escopo
- Plano: YCBM gaps (P1)
- Item: P1-3 (notificacoes por evento + templates por idioma)
- Itens implementados:
  - Registro de locale do cliente no booking.
  - Templates por idioma para confirmacao, cancelamento e reagendamento.
  - Envio de emails de cancelamento e reagendamento no fluxo publico.

## Fora de escopo (neste PR)
- UI para edicao de templates.
- Comparacao de baselines visuais.
- Notificacoes via SMS.

## Mudancas tecnicas
- Backend:
  - `customer_locale` no booking.
  - Mailables para cancelamento e reagendamento.
  - Selecao de locale por booking.
- Frontend:
  - Envio de `customer_locale` no POST do booking.
- Banco:
  - Coluna `customer_locale` em `bookings`.

## Arquivos principais alterados
- `app/Models/Booking.php`
- `app/Http/Controllers/BookingController.php`
- `app/Http/Controllers/PublicBookingController.php`
- `app/Mail/BookingConfirmation.php`
- `app/Mail/BookingCancelled.php`
- `app/Mail/BookingRescheduled.php`
- `resources/views/emails/bookings/*.blade.php`
- `resources/lang/*/emails.php`
- `database/migrations/2026_02_22_010000_add_customer_locale_to_bookings_table.php`
- `resources/js/Views/BookingPage.vue`

## Evidencias de teste
- [x] Build frontend executado
- [x] Smoke manual de envio (confirmacao, cancelamento, reagendamento) com MAIL_MAILER=log: **OK**
  - E-mail de confirmação renderizado e enviado via SMTP nos logs (ERRO RESOLVIDO).
  - Link de gerenciamento validado através de captura de token via rede/intercepção.

Comandos executados:
```bash
npm run build
```

Resultado:
- Build OK (vite build) - Pré-requisito
- Migration OK: Coluna `customer_locale` adicionada.
- Smoke Test: **OK** (Reteste realizado com sucesso em 2026-02-22).

Comandos executados em produção:
```bash
php artisan migrate --force
# Saída: INFO Running migrations. ... 2026_02_22_010000_add_customer_locale_to_bookings_table .... 70.64ms DONE
php artisan view:clear
php artisan config:clear
php artisan cache:clear
```

Reteste do Gate (2026-02-22 23:45):
- Booking pt-BR (ID 17): Criado, Reagendado e Cancelado (OK).
- Booking en (ID 16): Criado, Reagendado e Cancelado (OK).
- Verificação de Logs: Sucesso em todos os eventos. Nenhuma ocorrência de `No hint path defined for [mail]` após o fix.

## Gate
- [x] Templates por idioma aplicados
- [x] Templates por idioma aplicados (arquivos presentes no servidor)
- [x] Emails de cancelamento e reagendamento enviados (OK)

## Observacoes
- Locale do email segue `booking.customer_locale` com fallback em `schedulingPage.config.locale` e `app.locale`.
- Para ver o corpo do email, manter `MAIL_MAILER=log` e consultar `storage/logs/laravel.log`.
